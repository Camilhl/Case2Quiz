<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RegNewQuiz</title>
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="Style.css">
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>



    <script src="jquery-3.2.1.min.js"></script>
    <script language="javascript">

        var correctAnswer = []; //array of the index of correct answer on each question

        var numOfQuestions = 0; //the number of questions

        /**
         * Runs everytime an answer-alternative is chosen as the right one and being stored in an array.
         * @param questionNumber
         * @param val
         */
        function selectAnswer(questionNumber, val){

            correctAnswer[questionNumber] = val;
        }


        $(document).ready(function() {

            /**
             * Runs everytime the "add new question"-button is clicked
             * Adds another question-input-field to the page.
             */
            $("#newQ").click(function(){
                numOfQuestions += 1;

                //Using numOfQuestions to part each questions-ID from eachother
                $("#newQField").append('<div class="container" id="qBox">' +
                    '<h2 id="questionheader">Question ' + (numOfQuestions + 1) + '</h2>' +
                    '<label>Question:</label>' +
                    '<input name=0 id="q' + numOfQuestions + '" type="text" class="form-control">' +
                    '<label>Picture url (optional):</label>' +
                    '<input name=0 id="p' + numOfQuestions + '" type="text" class="form-control">' +
                    '<label>Time-limit (seconds):</label>' +
                    '<select name=0 id="t' + numOfQuestions + '" class="form-control">' +
                            '<option value="10">10 sec</option>' +
                        '<option value="20">20 sec</option>' +
                        '<option value="30">30 sec</option>' +
                        '<option value="40">40 sec</option>' +
                        '<option value="50">50 sec</option>' +
                        '<option value="60">60 sec</option>' +
                        '</select>' +
                    '<label>Answer-alternatives : (use checkbox to set the right answer)</label>' +
                    '<br>' +
                    '<div class="radio">' +
                    '<label><input type="radio" checked name="selectanswer' + numOfQuestions + '" onfocus="selectAnswer(' + numOfQuestions +', 0)"><input class="form-control" id="a1' + numOfQuestions + '" type="text" placeholder="Required"></label>' +
                    '</div>' +
                    '<div class="radio">' +
                    '<label><input type="radio" name="selectanswer' + numOfQuestions + '" onfocus="selectAnswer(' + numOfQuestions + ', 1)"><input class="form-control" id="a2' + numOfQuestions + '" type="text" placeholder="Required"></label>' +
                    '</div>' +
                    '<div class="radio">' +
                    '<label><input type="radio" name="selectanswer' + numOfQuestions + '" onfocus="selectAnswer(' + numOfQuestions +', 2)"><input class="form-control" id="a3' + numOfQuestions + '" type="text"></label>' +
                    '</div>' +
                    '<div class="radio">' +
                    '<label><input type="radio" name="selectanswer' + numOfQuestions + '" onfocus="selectAnswer(' + numOfQuestions +', 3)"><input class="form-control" id="a4' + numOfQuestions + '" type="text"></label>' +
                '</div></div><br>');
            });


            /**
             * Runs everytime "subit"-button is being clicked.
             * Tries to store the quiz and the questions to the rest-server.
             */
            $("#submit").click(function () {
                var ages = [];

                if($("#elders").is(":checked")){
                    ages.push("Elders");
                }
                if($("#middleage").is(":checked")){
                    ages.push("Middle age");
                }
                if($("#teens").is(":checked")){
                    ages.push("Teens");
                }
                if($("#children").is(":checked")){
                    ages.push("Children");
                }
                if($("#toddlers").is(":checked")){
                    ages.push("Todlers");
                }

                if($("#quizName").val() == ""){
                    alert("WARNING:\nYou have to chose a NAME for your quiz!");
                } else if($("#time").val() == "") {
                    alert("WARNING:\nYou have to chose a STARTING TIME for your quiz!");
                } else if(ages.length == 0){
                    alert("You have to choose the age-group for the quiz!");
                }else{
                    $.ajax({
                        url: 'rest/quizzes',
                        type: 'POST',
                        data: JSON.stringify({
                            "name": $("#quizName").val(),
                            "ages": ages,
                            "startTime": $("#time").val(),
                        }),

                        contentType: 'application/json; charset=utf-8', //''application/json; charset=utf-8',
                        dataType: 'json',


                        success: function (result) {
                            //alert("QUIZNAME added successfully")
                            addQuestions(); //adds the questions AFTER success of adding the quiz
                        },
                    });
                }


            });
        });

        /**
         * Runs when the Quiz is added successfully.
         * Tries to store Questions of the Quiz to the rest-server.
         */
        function addQuestions(){

            for (i = 0; i <= numOfQuestions; i++) {
                var q = "#q" + i + "";
                var p = "#p" + i + "";
                var t = "#t" + i + "";
                var a1 = "#a1" + i + "";
                var a2 = "#a2" + i + "";
                var a3 = "#a3" + i + "";
                var a4 = "#a4" + i + "";

                if(($(a1).val() == "" || $(a2).val() == "")){
                    alert("You have to add two answer alternatives!")
                    i = numOfQuestions + 1;
                }
                else {
                    $.ajax({
                        url: 'rest/quizzes/' + $("#quizName").val() + '/questions',
                        type: 'POST',
                        data: JSON.stringify({
                            "question": $(q).val(),
                            "timeLimit": $(t).val(),
                            "answers": [$(a1).val(), $(a2).val(), $(a3).val(), $(a4).val()],
                            "rightAnswerIndex": correctAnswer[i],
                            "url": $(p).val(),
                        }),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',

                        success: function (result) {
                            //alert("QUESTION added successfully");
                        },

                        statusCode: {
                            500: function () {
                                //alert("WARNING: Questions were not added successfully.\nPlease click ''Submit'' one more time!");

                                document.getElementById("warning").innerHTML = "Questions were not added successfully.\nPlease click ''Submit'' one more time!";
                            },
                        }
                    });
                }

                if(i == numOfQuestions){
                    window.location.href = 'MainWindow.html'; //sends you to the MainWindow once the quiz was added successfully
                }
            }
        }
    </script>
</head>
<body>

<ul id="topMenu">
    <li id="topMenuOptions"><img id="toplogo" src="https://image.ibb.co/mM8dUQ/Les_Quizerables.jpg" alt="Logo" height="100" width="200"></li>
    <li id="topMenuOptions"><a href="Frontpage.html">Home</a></li>
    <li id="topMenuOptions"><a href="MainWindow.html">Start quizzing!</a></li>
    <li id="topMenuOptions"><a href="regNewQuiz.html">Create new quiz</a></li>
</ul>

<div class="container">
    <h1>Register new quiz</h1>
    <label>Quiz-name:</label>
    <input id="quizName" type="text" class="form-control">
    <br>

    <label>Quiz starts at:</label>
    <p>(It is impossible to join the quiz after it has started)</p>

    <input id="time" type="datetime-local" class="form-control">
    <br>

    <label>Appropriate for:</label> <br>
        <p><input type="checkbox" id="elders">Elders</p>
        <p><input type="checkbox" id="middleage">Middle age</p>
        <p><input type="checkbox" id="teens">Teens</p>
        <p><input type="checkbox" id="children">Children</p>
        <p><input type="checkbox" id="toddlers">Toddlers</p>




</div>
    <br>
    <div class="container" id="qBox">
        <h2 id="questionheader">Question 1</h2>
        <label>Question:</label>
        <input name=0 id="q0" type="text" class="form-control">

        <label>Picture url (optional):</label>
        <input name=0 id="p0" type="text" class="form-control">

        <label>Time-limit (seconds):</label>
        <select name=0 id="t0" class="form-control">
            <option value="10">10 sec</option>
            <option value="20">20 sec</option>
            <option value="30">30 sec</option>
            <option value="40">40 sec</option>
            <option value="50">50 sec</option>
            <option value="60">60 sec</option>
        </select>


        <label>Answer-alternatives : (use checkbox to set the right answer)</label>
        <br>
        <div class="radio">
            <label><input type="radio" checked name="selectanswer0" onfocus="selectAnswer(0, '0')"><input class="form-control" id="a10" type="text" placeholder="Required"></label>
        </div>
        <div class="radio">
            <label><input type="radio" name="selectanswer0" onfocus="selectAnswer(0, '1')" ><input class="form-control" id="a20" type="text" placeholder="Required"></label></label>
        </div>
        <div class="radio">
            <label><input type="radio" name="selectanswer0" onfocus="selectAnswer(0, '2')"><input class="form-control" id="a30" type="text"></label></label>
        </div>
        <div class="radio">
            <label><input type="radio" name="selectanswer0" onfocus="selectAnswer(0, '3')"><input class="form-control" id="a40" type="text"></label></label>
        </div>


    </div>
<br>
<p id="newQField"></p>
<div class="container">
    <button id="newQ" type="button" class="btn btn-info btn-lg">+Add a new question</button>
    <button id="submit" type="button" class="btn btn-success btn-lg">Submit quiz</button>
    <h4 id="warning" color="red"></h4>
</div>
</body>
</html>