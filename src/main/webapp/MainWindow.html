<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MainWindow</title>
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="Style.css">
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="jquery-3.2.1.min.js"></script>
    <script language="javascript">

        $(document).ready(function() {
            loadData();
        });

        /**
         * Function that runs when a "join"-button is pressed.
         * Insert nick to join the quiz.
         * Sends you to the quiz-page.
         * @param quizNumber
         */
        function insertNick(quizNumber) {
            var quizName;
            var nickname = prompt("Please enter your nickname:", "Anonymus");

            if (nickname == null || nickname == "") {
                alert("User cancelled the prompt.");
            } else {

                $.get("rest/quizzes/", function (data) {
                    quizName = data[quizNumber].name;

                    $.ajax({ //player is being added to the quiz
                        url: 'rest/quizzes/' + quizName + '/players',
                        type: 'POST',
                        data: JSON.stringify({
                            "nickname": nickname,
                        }),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',

                        success: function (result) {
                            alert("Welcome to " + quizName + ", " + nickname + "!")
                            window.location.href = 'Questions.html?quizName=' + quizName + "&nickname=" + nickname; //sends the variable quizName and nickname to the Questions.html for further use
                        }
                    });
                });
            }
        }

        /**
         * Shows the scoreboard for a quiz in an alert.
         * @param quizNumber
         */

        function scoreBoard(quizNumber) {

            var quizName;
            var text = "!SCOREBOARD!\n"
            var placing = 1;

            $.get("rest/quizzes/", function (data) {
                quizName = data[quizNumber].name;

                window.location.href = 'ScoreBoard.html?quizName=' + quizName;

                /*

                $.get("rest/quizzes/" + quizName + "/players", function (data) {

                    if(data != null) {
                        for (i = 0; i < data.length; i++) {
                            if(data[i] != null) {
                                text += (placing) + " : " + data[i].nickname + ", score: " + data[i].score + "\n";
                                placing += 1;
                            }
                        }
                    }

                    alert(text);

                });*/
            });

        }

        /**
         * Loads all the quizzes and places it in the correct table (future quizzes, ongoing quizzes, ended quizzes) by comparing currentDate and startDate(newDate).
         */
        function loadData() {
            $("#cont2").append('<div class="row"> <div name="noquiz" id="noquiz" class="col-sm-12" style="background-color:#ffeee6;">No quizzes avaliable at the moment.. <a href="regNewQuiz.html">Create a new one!</a></div></div>');

            $.get("rest/quizzes/", function (data) {
                if (data != null) {
                    $("#noquiz").hide()

                    var quizName;
                    var quizTime;
                    var endDate;
                    var outputEnd;
                    var newDate;
                    var outputDate;
                    var currentTime = new Date();

                    for(i=0; i<data.length; i++) {

                        /*for(i=0; i< data.ages.length; i++){
                            ages += ", " + data.ages.length[i] + "";
                        }*/

                        quizName = data[i].name;
                        quizTime = data[i].startTime;

                        newDate = new Date(quizTime);

                        endDate = new Date(quizTime);
                        endDate.setSeconds(endDate.getSeconds() + data[i].totalTime);

                        if(newDate > currentTime){ //future quiz
                            console.log(data[i].questions.length);
                            outputDate = newDate.getDate() + "/" + (newDate.getMonth() + 1) + "/" + newDate.getFullYear() + ", at " + newDate.getHours() + ":" + newDate.getMinutes();
                            $("#cont2").append('<div class="row"> <div name="quizzes" id="' + i + '" class="col-sm-2" style="background-color:#ffcbb3;">' + quizName + '</div>' +
                                '<div class="col-sm-2" style="background-color:#ffdccc;">' + data[i].questions.length + ' </div>' +
                                '<div name="appropriate" title="Appropriate for: ' + data[i].ages + ' " id="' + i + '" class="col-sm-2" style="background-color:#ffcbb3;">' + data[i].ages + '</div>' +
                                '<div class="col-sm-2" style="background-color:#ffdccc;">' + outputDate + '</div>' +
                                '<div class="col-sm-2" style="background-color:#ffcbb3;">' + data[i].players.length + ' </div>' +
                                '<div class="col-sm-2" style="background-color:#ffdccc;"><a id="joinButton" onclick="insertNick(' + i + ')">Join</a></div></div>');
                        }else{
                            if (endDate < currentTime) { //quiz is over
                                outputEnd = endDate.getDate() + "/" + (endDate.getMonth() + 1) + "/" + endDate.getFullYear() + ", at " + endDate.getHours() + ":" + endDate.getMinutes();
                                $("#cont3").append('<div class="row"> <div name="quizzes" id="' + i + '" class="col-sm-4" style="background-color:#ffdccc;">' + quizName + '</div><div class="col-sm-4" style="background-color:#ffcbb3;">' + outputEnd + '</div><div class="col-sm-4" style="background-color:#ffdccc;"><a id="scoreboardButton" onclick="scoreBoard(' + i + ')">ScoreBoard</a></div></div>');
                            }
                            else if(endDate > currentTime){ //ongoing quizzes
                                outputDate = newDate.getDate() + "/" + (newDate.getMonth() + 1) + "/" + newDate.getFullYear() + ", at " + newDate.getHours() + ":" + newDate.getMinutes();
                                $("#cont1").append('<div class="row"> <div name="quizzes" id="' + i + '" class="col-sm-4" style="background-color:#ffdccc;">' + quizName + '</div><div class="col-sm-4" style="background-color:#ffcbb3;">' + outputDate + '</div><div class="col-sm-4" style="background-color:#ffdccc;"><a id="scoreboardButton" onclick="scoreBoard(' + i + ')">ScoreBoard</a></div></div>');
                            }
                        }
                    }

                }
                else{
                }
            });
        }
    </script>

</head>
<body>
<ul id="topMenu">
    <li id="topMenuOptions"><img id="toplogo" src="https://image.ibb.co/mM8dUQ/Les_Quizerables.jpg" alt="Logo" height="100" width="200"></li>
    <li id="topMenuOptions"><a href="Frontpage.html">Home</a></li>
    <li id="topMenuOptions"><a href="MainWindow.html">Start quizzing!</a></li>
    <li id="topMenuOptions"><a href="regNewQuiz.html">Create new quiz</a></li>
</ul>
<div class="container" id="picCont">
<img id="midlogo" align="middle" src="https://i.imgur.com/y3RIV5D.jpg" alt="Logo" height="150" width="300">
</div>
    <!--<img id="midlogo" align="middle" src="http://i67.tinypic.com/167sefa.png" alt="Logo" height="200" width="400">-->
<div class="container" id="cont2">
    <h2 id="mainWindowHeadline2">Future quizzes:</h2>
    <ul id="futureQuizzes" style="list-style-type:disc">
    </ul>
    <div class="row">
        <div name="quizzes" class="col-sm-2" style="background-color:#ffcbb3;"><dt>Quiz names</dt></div>
        <div class="col-sm-2" style="background-color:#ffdccc;"><dt>Questions</dt></div>
        <div name="quizzes" class="col-sm-2" style="background-color:#ffcbb3;"><dt>Appropriate for:</dt></div>
        <div class="col-sm-2" style="background-color:#ffdccc;"><dt>Starting time</dt></div>
        <div class="col-sm-2" style="background-color:#ffcbb3;"><dt>Players</dt></div>
        <div class="col-sm-2" style="background-color:#ffdccc;"><dt>Join the quiz!</dt></div>
    </div>
</div>
<br>
<br>
<div class="container" id="cont1">
<h2 id="mainWindowHeadline1">Ongoing quizzes:</h2>
<ul id="ongoingQuizzes" style="list-style-type:disc">
</ul>
    <div class="row">
        <div name="quizzes" id="-1" class="col-sm-4" style="background-color:#ffdccc;"><dt>Quiz names</dt></div>
        <div class="col-sm-4" style="background-color:#ffcbb3;"><dt>Started</dt></div>
        <div class="col-sm-4" style="background-color:#ffdccc;"><dt>View the scoreboard!</dt></div>
    </div>
</div>
<br>
<br>

<div class="container" id="cont3">
    <h2 id="mainWindowHeadline3">Ended quizzes:</h2>
    <ul id="finishedQuizze" style="list-style-type:disc">
    </ul>
    <div class="row">
        <div name="quizzes" class="col-sm-4" style="background-color:#ffdccc;"><dt>Quiz names</dt></div>
        <div class="col-sm-4" style="background-color:#ffcbb3;"><dt>Ended</dt></div>
        <div class="col-sm-4" style="background-color:#ffdccc;"><dt>View the scoreboard!</dt></div>
    </div>
</div>
<br>
<br>


</body>
</html>