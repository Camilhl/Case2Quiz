<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MainWindow</title>
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="Style.css">
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="jquery-3.2.1.min.js"></script>
    <script language="javascript">

        $(document).ready(function() {
            loadData();
        });

        function insertNick(quizNumber) {
            var quizName;
            var nickname = prompt("Please enter your nickname:", "Anonymus");

            if (nickname == null || nickname == "") {
                alert("User cancelled the prompt.");
            } else {

                $.get("rest/quizzes/", function (data) {
                    quizName = data[quizNumber].name;

                    $.ajax({
                        url: 'rest/quizzes/' + quizName + '/players',
                        type: 'POST',
                        data: JSON.stringify({
                            "nickname": nickname,
                        }),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',

                        success: function (result) {
                            alert("Welcome to " + quizName + ", " + nickname + "!")
                            window.location.href = 'Questions.html?quizName=' + quizName + "&nickname=" + nickname;
                        }
                    });
                });
            }
        }

        function scoreBoard(quizNumber) {

            var quizName;
            var text = "!SCOREBOARD!\n"
            var placing = 1;

            $.get("rest/quizzes/", function (data) {
                quizName = data[quizNumber].name;

                $.get("rest/quizzes/" + quizName + "/players", function (data) {

                    if(data != null) {
                        for (i = 0; i < data.length; i++) {
                            if(data[i] != null) {
                                text += (placing) + " : " + data[i].nickname + ", score: " + data[i].score + "\n";
                                placing += 1;
                            }
                        }
                    }

                    alert(text);

                });
            });

        }

        function loadData() {
            $.get("rest/quizzes/", function (data) {
                if (data != null) {

                    var quizName;
                    var quizTime;

                    //$("#container").append('<div class="row"> <div name="quizzes" id="-1" class="col-sm-4" style="background-color:#ffdccc;"><dt>Quiz names</dt></div><div class="col-sm-4" style="background-color:#ffcbb3;"><dt>Quiz starts at</dt></div><div class="col-sm-4" style="background-color:#ffdccc;"></div></div>');

                    var currentTime = new Date();

                    console.log("currentTime: " + currentTime);
                    console.log("day: " + currentTime.getDay());
                    for(i=0; i<data.length; i++) {

                        quizName = data[i].name;
                        quizTime = data[i].startTime;

                        var newDate = new Date(quizTime);
                        var outputDate = newDate.getDate() + "/" + (newDate.getMonth() + 1) + "/" + newDate.getFullYear() + ", at " + newDate.getHours() + ":" + newDate.getMinutes();

                        if(quizTime < currentTime){
                            $("#cont1").append('<div class="row"> <div name="quizzes" id="' + i + '" class="col-sm-3" style="background-color:#ffdccc;">' + quizName + '</div><div class="col-sm-3" style="background-color:#ffcbb3;">' + outputDate + '</div><div class="col-sm-3" style="background-color:#ffdccc;"><a id="scoreboardButton" onclick="scoreBoard(' + i + ')">ScoreBoard</a></div><div class="col-sm-3" style="background-color:#ffcbb3;"><a id="joinButton" onclick="insertNick(' + i + ')">Join</a></div></div>');
                        } else {
                            $("#cont2").append('<div class="row"> <div name="quizzes" id="' + i + '" class="col-sm-6" style="background-color:#ffdccc;">' + quizName + '</div><div class="col-sm-6" style="background-color:#ffcbb3;">' + outputDate + '</div></div>');
                        }


                        //$("#ongoingQuizzes").append('<li name="quizzes" id="' + i + '">' + quizName + '<a id="joinButton" onclick="insertNick(' + i + ')">Join</a><a id="scoreboardButton" onclick="scoreBoard(' + i + ')">ScoreBoard</a></li><br>');

                        //$("#container").append('<div class="row"> <div name="quizzes" id="' + i + '" class="col-sm-3" style="background-color:#ffdccc;">' + quizName + '</div><div class="col-sm-3" style="background-color:#ffcbb3;">' + quizTime + '</div><div class="col-sm-3" style="background-color:#ffdccc;"><a id="scoreboardButton" onclick="scoreBoard(' + i + ')">ScoreBoard</a></div><div class="col-sm-3" style="background-color:#ffcbb3;"><a id="joinButton" onclick="insertNick(' + i + ')">Join</a></div></div>');
                    }

                }

            })
        }
    </script>

</head>
<body>
<ul id="topMenu">
    <li id="topMenuOptions"><img id="toplogo" src="https://image.ibb.co/mM8dUQ/Les_Quizerables.jpg" alt="Logo" height="100" width="200"></li>
    <li id="topMenuOptions"><a href="Frontpage.html">Home</a></li>
    <li id="topMenuOptions"><a href="MainWindow.html">Start quizzing!</a></li>
    <li id="topMenuOptions"><a href="regNewQuiz.html">Create new quiz</a></li>
    <li id="topMenuOptions"><a href="#contact">Contact</a></li>
    <li id="topMenuOptions"><a href="#about">About</a></li>
</ul>
<div class="container">
<img id="midlogo" align="middle" src="https://i.imgur.com/y3RIV5D.jpg" alt="Logo" height="150" width="300">
</div>
    <!--<img id="midlogo" align="middle" src="http://i67.tinypic.com/167sefa.png" alt="Logo" height="200" width="400">-->
<div class="container" id="cont1">
<h2 id="mainWindowHeadline1">Ongoing quizzes:</h2>
<ul id="ongoingQuizzes" style="list-style-type:disc">
</ul>
    <div class="row">
        <div name="quizzes" id="-1" class="col-sm-3" style="background-color:#ffdccc;"><dt>Quiz names</dt></div>
        <div class="col-sm-3" style="background-color:#ffcbb3;"><dt>Started</dt></div>
        <div class="col-sm-3" style="background-color:#ffdccc;"><dt>View the scoreboard!</dt></div>
        <div class="col-sm-3" style="background-color:#ffcbb3;"><dt>Join the quiz!</dt></div>
    </div>
</div>
<br>
<div class="container" id="cont2">
<h2 id="mainWindowHeadline2">Future quizzes:</h2>
<ul id="futureQuizzes" style="list-style-type:disc">
</ul>
    <div class="row">
        <div name="quizzes" class="col-sm-6" style="background-color:#ffdccc;"><dt>Quiz names</dt></div>
        <div class="col-sm-6" style="background-color:#ffcbb3;"><dt>Starting time</dt></div>
    </div>
</div>


</body>
</html>